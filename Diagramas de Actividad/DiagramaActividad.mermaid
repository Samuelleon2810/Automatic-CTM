---
config:
  look: handDrawn
  theme: default
---
flowchart TD
    Start([ğŸ¬ Inicio]) --> InsertarTarjeta[/Cliente Inserta Tarjeta/]
    
    InsertarTarjeta --> LeerTarjeta[Leer Datos de Tarjeta]
    
    LeerTarjeta --> ValidarTarjeta{Â¿Tarjeta VÃ¡lida?}
    
    ValidarTarjeta -->|No| MostrarErrorTarjeta[Mostrar Error:<br/>Tarjeta InvÃ¡lida]
    MostrarErrorTarjeta --> ExpulsarTarjeta1[Expulsar Tarjeta]
    ExpulsarTarjeta1 --> Fin1([ğŸ”š Fin])
    
    ValidarTarjeta -->|SÃ­| SolicitarPassword[Solicitar ContraseÃ±a]
    
    SolicitarPassword --> IngresarPassword[/Cliente Ingresa Password/]
    
    IngresarPassword --> ValidarPassword{Â¿Password<br/>Correcto?}
    
    ValidarPassword -->|No| IncrementarIntentos[Incrementar<br/>Contador Intentos]
    
    IncrementarIntentos --> VerificarIntentos{Â¿Intentos < 3?}
    
    VerificarIntentos -->|SÃ­| MostrarErrorPass[Mostrar Error:<br/>Password Incorrecto]
    MostrarErrorPass --> SolicitarPassword
    
    VerificarIntentos -->|No| InvalidarTarjeta[âŒ Invalidar Tarjeta<br/>en Sistema]
    InvalidarTarjeta --> RetenerTarjeta[Retener Tarjeta<br/>FÃ­sicamente]
    RetenerTarjeta --> NotificarAdmin[Notificar a<br/>Administrador]
    NotificarAdmin --> Fin2([ğŸ”š Fin])
    
    ValidarPassword -->|SÃ­| MostrarMenu[Mostrar MenÃº<br/>Principal]
    
    MostrarMenu --> SeleccionarOperacion{Cliente<br/>Selecciona<br/>OperaciÃ³n}
    
    SeleccionarOperacion -->|Retiro| IniciarRetiro[ğŸ Iniciar Proceso<br/>de Retiro]
    SeleccionarOperacion -->|DepÃ³sito| IniciarDeposito[ğŸ’° Iniciar Proceso<br/>de DepÃ³sito]
    SeleccionarOperacion -->|Consulta| IniciarConsulta[ğŸ“Š Iniciar Proceso<br/>de Consulta]
    SeleccionarOperacion -->|Compra| IniciarCompra[ğŸ« Iniciar Proceso<br/>de Compra]
    SeleccionarOperacion -->|Salir| FinalizarSesion[Finalizar SesiÃ³n]
    
    %% FLUJO DE RETIRO DETALLADO
    IniciarRetiro --> VerificarCuentas{Â¿Cliente tiene<br/>mÃºltiples cuentas?}
    
    VerificarCuentas -->|SÃ­| MostrarCuentas[Mostrar Lista<br/>de Cuentas]
    MostrarCuentas --> SeleccionarCuenta[/Cliente Selecciona<br/>Cuenta/]
    SeleccionarCuenta --> MostrarOpciones
    
    VerificarCuentas -->|No| MostrarOpciones[Mostrar Opciones<br/>de Montos]
    
    MostrarOpciones --> SeleccionarMonto[/Cliente Selecciona<br/>o Ingresa Monto/]
    
    SeleccionarMonto --> ValidarMonto{Â¿Monto es<br/>mÃºltiplo de<br/>10,000?}
    
    ValidarMonto -->|No| ErrorMontoInvalido[Error: Monto debe ser<br/>mÃºltiplo de 10,000]
    ErrorMontoInvalido --> MostrarOpciones
    
    ValidarMonto -->|SÃ­| ConsultarSaldo[Consultar Saldo<br/>en Base de Datos]
    
    ConsultarSaldo --> VerificarSaldo{Â¿Saldo<br/>Suficiente?}
    
    VerificarSaldo -->|No| ErrorSaldoInsuficiente[âŒ Error:<br/>Saldo Insuficiente]
    ErrorSaldoInsuficiente --> MostrarSaldoDisp[Mostrar Saldo<br/>Disponible]
    MostrarSaldoDisp --> OpcionReintentar{Â¿Desea<br/>Reintentar?}
    OpcionReintentar -->|SÃ­| MostrarOpciones
    OpcionReintentar -->|No| MostrarMenu
    
    VerificarSaldo -->|SÃ­| ConsultarLimite[Consultar LÃ­mite<br/>Diario]
    
    ConsultarLimite --> CalcularDisponible[Calcular LÃ­mite<br/>Disponible del DÃ­a]
    
    CalcularDisponible --> VerificarLimite{Â¿Monto dentro<br/>del lÃ­mite?}
    
    VerificarLimite -->|No| ErrorLimiteExcedido[âŒ Error:<br/>LÃ­mite Diario Excedido]
    ErrorLimiteExcedido --> MostrarLimiteDisp[Mostrar LÃ­mite<br/>Disponible]
    MostrarLimiteDisp --> OpcionReintentar
    
    VerificarLimite -->|SÃ­| MostrarResumen[Mostrar Resumen<br/>de TransacciÃ³n]
    
    MostrarResumen --> SolicitarConfirmacion[/Solicitar ConfirmaciÃ³n<br/>al Cliente/]
    
    SolicitarConfirmacion --> ClienteConfirma{Â¿Cliente<br/>Confirma?}
    
    ClienteConfirma -->|No| CancelarTransaccion[Cancelar TransacciÃ³n]
    CancelarTransaccion --> MostrarMenu
    
    ClienteConfirma -->|SÃ­| VerificarBilletes[Verificar Disponibilidad<br/>de Billetes]
    
    VerificarBilletes --> BilletesDisponibles{Â¿Hay Billetes<br/>Suficientes?}
    
    BilletesDisponibles -->|No| ErrorSinBilletes[âŒ Error:<br/>Cajero Sin Efectivo]
    ErrorSinBilletes --> DisculparCliente[Disculparse con Cliente]
    DisculparCliente --> MostrarMenu
    
    BilletesDisponibles -->|SÃ­| ActualizarBD[(Actualizar Saldo<br/>en Base de Datos)]
    
    ActualizarBD --> RegistrarRetiro[(Registrar Retiro<br/>en Log Diario)]
    
    RegistrarRetiro --> DispensarDinero[ğŸ’µ Dispensar Billetes]
    
    DispensarDinero --> AbrirBandeja[Abrir Bandeja<br/>de Entrega]
    
    AbrirBandeja --> EsperarRetiro[â³ Esperar a que Cliente<br/>Retire Efectivo]
    
    EsperarRetiro --> VerificarRetiro{Â¿Cliente<br/>RetirÃ³ Dinero?}
    
    VerificarRetiro -->|No| AlertaSonora[ğŸ”” Emitir Alerta<br/>Sonora]
    AlertaSonora --> Timeout{Â¿Timeout<br/>Excedido?}
    Timeout -->|No| EsperarRetiro
    Timeout -->|SÃ­| RetraerBilletes[Retraer Billetes<br/>no Retirados]
    RetraerBilletes --> RevertirTransaccion[Revertir TransacciÃ³n<br/>en Base de Datos]
    RevertirTransaccion --> MostrarMenu
    
    VerificarRetiro -->|SÃ­| PreguntarRecibo{Â¿Desea<br/>Recibo?}
    
    PreguntarRecibo -->|SÃ­| ImprimirRecibo[ğŸ–¨ï¸ Imprimir Recibo]
    ImprimirRecibo --> EntregarRecibo[Entregar Recibo]
    EntregarRecibo --> PreguntarMas
    
    PreguntarRecibo -->|No| PreguntarMas{Â¿Desea Otra<br/>OperaciÃ³n?}
    
    PreguntarMas -->|SÃ­| MostrarMenu
    PreguntarMas -->|No| FinalizarSesion
    
    %% OTROS FLUJOS (simplificados)
    IniciarDeposito --> ProcesarDeposito[ğŸ“¦ Procesar DepÃ³sito<br/>Ver Subproceso]
    ProcesarDeposito --> PreguntarMas
    
    IniciarConsulta --> ProcesarConsulta[ğŸ“ˆ Procesar Consulta<br/>Ver Subproceso]
    ProcesarConsulta --> PreguntarMas
    
    IniciarCompra --> ProcesarCompra[ğŸ­ Procesar Compra<br/>Ver Subproceso]
    ProcesarCompra --> PreguntarMas
    
    %% FINALIZACIÃ“N
    FinalizarSesion --> ImprimirResumen[Imprimir Resumen<br/>de SesiÃ³n]
    
    ImprimirResumen --> ExpulsarTarjeta[Expulsar Tarjeta]
    
    ExpulsarTarjeta --> MensajeDespedida[Mostrar Mensaje:<br/>'Gracias por usar<br/>nuestros servicios']
    
    MensajeDespedida --> RegistrarLogFinal[(Registrar Log<br/>de SesiÃ³n)]
    
    RegistrarLogFinal --> LimpiarPantalla[Limpiar Pantalla]
    
    LimpiarPantalla --> FinNormal([âœ… Fin])
    
    %% Estilos
    classDef startEnd fill:#90EE90,stroke:#006400,stroke-width:3px,color:#000
    classDef process fill:#87CEEB,stroke:#4682B4,stroke-width:2px,color:#000
    classDef decision fill:#FFD700,stroke:#FF8C00,stroke-width:2px,color:#000
    classDef error fill:#FFB6C1,stroke:#DC143C,stroke-width:2px,color:#000
    classDef database fill:#E6E6FA,stroke:#9370DB,stroke-width:2px,color:#000
    classDef input fill:#FFDAB9,stroke:#CD853F,stroke-width:2px,color:#000
    
    class Start,Fin1,Fin2,FinNormal startEnd
    class LeerTarjeta,SolicitarPassword,MostrarMenu,IniciarRetiro,MostrarOpciones,ConsultarSaldo,ConsultarLimite,CalcularDisponible,MostrarResumen,VerificarBilletes,DispensarDinero,AbrirBandeja,ImprimirRecibo,EntregarRecibo,FinalizarSesion,ImprimirResumen,ExpulsarTarjeta,MensajeDespedida,LimpiarPantalla,MostrarCuentas,ProcesarDeposito,ProcesarConsulta,ProcesarCompra,EsperarRetiro,AlertaSonora,RetraerBilletes,DisculparCliente process
    class ValidarTarjeta,ValidarPassword,VerificarIntentos,SeleccionarOperacion,VerificarCuentas,ValidarMonto,VerificarSaldo,VerificarLimite,ClienteConfirma,BilletesDisponibles,VerificarRetiro,PreguntarRecibo,PreguntarMas,OpcionReintentar,Timeout decision
    class MostrarErrorTarjeta,MostrarErrorPass,InvalidarTarjeta,RetenerTarjeta,ErrorSaldoInsuficiente,ErrorLimiteExcedido,ErrorMontoInvalido,CancelarTransaccion,ErrorSinBilletes,RevertirTransaccion error
    class ActualizarBD,RegistrarRetiro,RegistrarLogFinal database
    class InsertarTarjeta,IngresarPassword,SeleccionarCuenta,SeleccionarMonto,SolicitarConfirmacion input
